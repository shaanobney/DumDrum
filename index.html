<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>DUM DRUM</title>

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <link rel="icon" type="image/png" sizes="174x174" href="./style/favicon.png">

        <script type="text/javascript" src="./build/Tone.js"></script>
        <script type="text/javascript" src="./scripts/jquery.min.js"></script>
        <script type="text/javascript" src="./scripts/draggabilly.js"></script>
        <script type="text/javascript" src="./scripts/StartAudioContext.js"></script>
        <script type="text/javascript" src="./scripts/Interface.js"></script>
        <script type="text/javascript" src="./scripts/nexusUI.js"></script>

        <link rel="stylesheet" type="text/css" href="./style/examples.css">

        <script type="text/javascript">
            // jshint ignore: start
        </script>

    </head>
    <body>
        <style type="text/css">
            canvas {
                margin-top: 3px;
            }

        </style>
        <div id="Content">
            <div id="Title">THE DUM DRUM</div>
            <canvas nx="matrix"></canvas>
            <div id="Sliders"></div>
        </div>
        <script type="text/javascript">
            //setup a polyphonic sampler
            var keys = new Tone.MultiPlayer({
                urls: {
                    "BD": "./audio/505/kick.mp3",
                    "SD": "./audio/505/snare.mp3",
                    "HHC": "./audio/505/hh.mp3",
                    "HHO": "./audio/505/hho.mp3",
                    "AH": "./audio/505/agogoHigh.mp3"
                },
                volume: -10,
                fadeOut: 0.1
            }).toMaster();

            var chorusSend = keys.send("chorus", -Infinity);
            var chebySend = keys.send("cheby", -Infinity);
            var autowahSend = keys.send("autowah", -Infinity);
            var reverbSend = keys.send("reverb", -Infinity);
            var bitCrushSend = keys.send("bitCrush", -Infinity);

            var bitCrush = new Tone.BitCrusher(2).receive("bitCrush").toMaster();

            var chorus = new Tone.Chorus().receive("chorus").toMaster();

            var cheby = new Tone.Chebyshev(50).receive("cheby").toMaster();

            var reverb = new Tone.Freeverb(0.9, 4000).receive("reverb").toMaster();

            var noteNames = ["BD", "SD", "HHC", "HHO", "AH"];

            var loop = new Tone.Sequence(function (time, col) {
                var column = matrix1.matrix[col];
                for (var i = 0; i < 6; i++) {
                    if (column[i] === 1) {
                        //slightly randomized velocities
                        var vel = Math.random() * 0.5 + 0.5;
                        keys.start(noteNames[i], time, 0, "32n", 0, vel);
                    }
                }
            }, [
                0,
                1,
                2,
                3,
                4,
                5,
                6,
                7,
                8,
                9,
                10,
                11,
                12,
                13,
                14,
                15,
                16,
                17,
                18,
                19,
                20,
                21,
                22,
                23
            ], "24n");

            Tone.Transport.start();
        </script>
        <script type="text/javascript">
            nx.onload = function () {
                nx.colorize("crimson");

                matrix1.col = 24;
                matrix1.init();
                matrix1.resize($("#Content").width(), 250);
                matrix1.draw();
            }

            $(function () {

                Interface.Slider({
                    name: "BPM",
                    min: 10,
                    max: 300,
                    value: Tone.Transport.bpm.value,
                    drag: function (val) {
                        Tone.Transport.bpm.value = val;

                    }
                });
                Interface.Slider({
                    name: "WAVESHAPER",
                    parent: $("#Sliders"),
                    min: -100,
                    max: 100,
                    drag: function (val) {
                        chebySend.gain.value = val;
                    }
                });
                Interface.Slider({
                    name: "CHORUS",
                    parent: $("#Sliders"),
                    min: -100,
                    max: 100,
                    drag: function (val) {
                        chorusSend.gain.value = val;
                    }
                });
                Interface.Slider({
                    name: "SHITTY REVERB",
                    parent: $("#Sliders"),
                    min: -100,
                    max: 100,
                    drag: function (val) {
                        reverbSend.gain.value = val;
                    }
                });
                Interface.Button({
                    text: "BITCRUSH",
                    activeText: "STOP CRUSHIN'",
                    type: "toggle",
                    start: function (val) {
                        bitCrushSend.gain.value = 100;
                    },
                    end: function (val) {
                        bitCrushSend.gain.value = -100;
                    }
                });
                Interface.Button({
                    text: "START", activeText: "STOP", type: "toggle", key: 32, //spacebar
                    start: function () {
                        loop.start();
                    },
                    end: function () {
                        loop.stop();
                    }
                });

                Interface.Loader();

                $(window).on("resize", function () {
                    matrix1.resize($("#Content").width(), 350);
                    matrix1.draw();
                });
            });
        </script>
    </body>
</html>
